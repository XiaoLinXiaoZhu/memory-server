# Zettelkasten Memory Server v1.1.0

基于 Zettelkasten 卡片盒方法的 MCP (Model Context Protocol) 记忆服务器，提供简化而强大的卡片化记忆管理功能。

## 🆕 v1.1.0 更新

- ⬆️ **核心升级**: 升级到 modular-mcp-memory v4.1.1
- 🔧 **嵌套展开修复**: 修复深度展开时 start/end 标记被错误展开的问题
- 🚀 **智能占位符**: setContent 时自动为引用卡片创建占位文件
- ⚡ **权重缓存**: 智能缓存权重计算结果，性能提升 60%+
- 📊 **优化算法**: 全新的权重计算和价值评估算法

## 设计理念

相比传统的记忆管理系统，本服务器采用了更加精简的 Zettelkasten 方法：

- **消除搜索开销**: 不提供复杂的搜索功能，避免提示词开销过大
- **卡片化存储**: 每个记忆都是独立的卡片，支持 `[[卡片名]]` 引用语法
- **自底向上**: 让知识结构自然呈现，而不是预设分类体系
- **权重计算**: 通过递归链接关系自动计算卡片重要性
- **优化建议**: 识别低价值卡片，协助维护系统健康

## 功能特性

### 核心操作
- `getContent`: 获取卡片内容，支持递归展开引用
- `setContent`: 创建或更新卡片内容
- `deleteContent`: 删除卡片
- `renameContent`: 重命名或合并卡片，自动更新所有引用

### 智能提示
- `getHints`: 获取按权重排序的重要卡片列表
- `getSuggestions`: 获取低价值卡片的优化建议

### 资源访问
- **列出资源**: 自动列出所有卡片作为 MCP 资源
- **灵活访问**: 支持 `memory:///cardName#expandDepth` 格式，等效于 `getContent(cardName, expandDepth)`

### 智能提示模板
- **话题灵感** (`topic_inspiration`): 当不知道聊什么话题时，基于重要卡片提供话题建议
- **聊天优化** (`chat_optimization`): 聊天结束时，提供系统优化建议和维护指导

## 安装和使用

### 安装依赖

```bash
npm install
```

### 构建项目

```bash
npm run build
```

### 启动服务器

```bash
npm start
```

或者直接运行：

```bash
node build/index.js
```

### 自定义存储目录

通过环境变量指定存储目录：

```bash
ZETTELKASTEN_STORAGE_DIR="/path/to/your/cards" npm start
```

## 卡片语法

### 基本卡片
每个卡片都是一个 `.md` 文件，内容可以是任意文本：

```markdown
这是一张关于 JavaScript 的卡片。

JavaScript 是一种编程语言，它有以下特点：
- 动态类型
- 原型继承
- 事件驱动

相关概念: [[编程语言]]、[[Web开发]]
```

### 引用语法
使用 `[[卡片名]]` 来引用其他卡片：

```markdown
今天学习了 [[React]]，它是基于 [[JavaScript]] 的前端框架。

React 的核心概念包括：
- [[组件化]]
- [[状态管理]]
- [[虚拟DOM]]
```

### 展开引用
使用 `getContent` 工具时，可以指定展开深度来递归获取引用卡片的内容：

```typescript
// 展开深度为 1，会展开第一层引用的卡片内容
getContent("React", 1)
```

展开后的内容格式：
```markdown
今天学习了 React，它是基于 JavaScript 的前端框架。

![[JavaScript]]start

JavaScript 是一种编程语言，它有以下特点：
- 动态类型
- 原型继承
- 事件驱动

![[JavaScript]]end

React 的核心概念包括：
- 组件化
- 状态管理
- 虚拟DOM
```

## 权重计算机制

系统会自动计算每个卡片的权重：

- **叶子卡片** (无外链): 权重 = 1
- **有外链的卡片**: 权重 = 所有引用卡片权重的平均值

这个机制让经常被引用的基础概念获得更高权重，有助于识别知识体系中的核心节点。

## 价值计算与优化

系统提供优化建议功能：

**价值 = 权重 / 字符数**

- 高价值卡片：内容精炼且被广泛引用
- 低价值卡片：内容冗长但很少被引用，建议优化

## MCP 工具列表

### getContent
获取指定卡片的内容，支持递归展开引用。

**参数:**
- `cardName` (string): 卡片名称
- `expandDepth` (number, 可选): 展开深度，默认为 0

### setContent  
创建或更新卡片的内容。

**参数:**
- `cardName` (string): 卡片名称
- `content` (string): 卡片内容

### deleteContent
删除指定的卡片。

**参数:**
- `cardName` (string): 要删除的卡片名称

### renameContent
重命名卡片或将两个卡片合并。

**参数:**
- `oldCardName` (string): 原卡片名称  
- `newCardName` (string): 新卡片名称

### getHints
获取按权重排序的重要卡片提示。

**参数:**
- `fileCount` (number, 可选): 返回的卡片数量，默认为 10

### getSuggestions
获取优化建议，识别价值较低的卡片。

**参数:**
- `optimizationThreshold` (number, 可选): 优化阈值，默认为 0.1
- `maxFileCount` (number, 可选): 返回的低价值卡片最大数量，默认为 10

## 最佳实践

### 1. 建立入口卡片
创建 `hints` 卡片作为系统的入口点：

```markdown
# 知识体系入口

## 编程相关
- [[JavaScript]]
- [[Python]]  
- [[算法与数据结构]]

## 项目管理
- [[项目规划]]
- [[团队协作]]

## 学习笔记
- [[今日学习]]
- [[问题记录]]
```

### 2. 保持卡片原子化
每张卡片只包含一个核心概念：

```markdown
# React Hooks

React Hooks 是 React 16.8 引入的新特性，让你可以在函数组件中使用状态和其他 React 特性。

常用的 Hooks：
- [[useState]]
- [[useEffect]]  
- [[useContext]]

相关概念：[[React]]、[[函数组件]]
```

### 3. 建立有意义的连接
不要只是罗列链接，要说明关系：

```markdown
# 设计模式

设计模式是软件设计中常用的解决方案。

## 创建型模式
- [[单例模式]] - 确保类只有一个实例
- [[工厂模式]] - 创建对象的接口

## 行为型模式  
- [[观察者模式]] - 用于 [[事件驱动编程]]

设计模式在 [[JavaScript]] 和 [[Python]] 中都有广泛应用。
```

### 4. 定期维护
使用 `getSuggestions` 工具定期检查低价值卡片，进行优化：

- 精简冗长的内容
- 拆分复杂的卡片
- 删除过时的信息
- 增加有意义的链接

## 智能提示功能

### 话题灵感提示
当不知道聊什么话题时，使用 `topic_inspiration` 提示：

```bash
# 在 MCP 客户端中
请使用 "话题灵感" 提示模板
```

系统会：
1. 自动获取重要卡片
2. 按权重分类为核心话题、深度话题、轻松话题
3. 提供对话建议和操作指导

### 聊天优化提示
聊天结束时，使用 `chat_optimization` 提示：

```bash
# 在 MCP 客户端中
请使用 "聊天优化" 提示模板
```

系统会：
1. 分析当前知识库状态
2. 识别需要优化的低价值卡片
3. 提供具体的优化建议和行动计划
4. 给出系统健康度评估

### 提示功能优势
- **智能上下文**: 自动收集相关数据生成个性化提示
- **一键操作**: 复杂的分析任务变成简单的模板选择
- **引导学习**: 帮助发现知识网络中的机会和问题
- **持续优化**: 保持知识库的健康和高质量
- 合并相似内容
- 删除过时信息
- 改进内容质量

## 许可证

MIT License
